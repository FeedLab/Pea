<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:picker="clr-namespace:Syncfusion.Maui.Picker;assembly=Syncfusion.Maui.Picker"
             x:Class="Pea.Meter.View.TouVsFlatRateView">

    <VerticalStackLayout
        Margin="30,0,30,0"
        HorizontalOptions="Center"
        VerticalOptions="Center">

        <Grid HeightRequest="60">
            <Border
                x:Name="StartDateCtrl"
                BackgroundColor="White"
                Stroke="LightBlue"
                StrokeShape="RoundRectangle 5,5,5,5" HorizontalOptions="Center" VerticalOptions="Center" Margin="0"
                Padding="0">
                <Grid VerticalOptions="Center" HeightRequest="50" WidthRequest="300">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="0.2*" />
                        <ColumnDefinition Width="0.5*" />
                        <ColumnDefinition Width="0.3*" />
                    </Grid.ColumnDefinitions>

                    <Label
                        TextColor="Black" FontSize="15"
                        HorizontalOptions="Center" VerticalOptions="Center" Text="&#xe72e;" />

                    <Label Grid.Column="1" Text="Start date" Margin="0, 0, 5, 0"
                           TextColor="Black"
                           FontSize="13" VerticalOptions="Center" LineBreakMode="WordWrap" 
                           />

                    <Label Grid.Column="2" Text="{Binding StartDate}" FontSize="13"
                           TextColor="Black"
                           VerticalTextAlignment="Center" LineBreakMode="WordWrap" />

                    <Grid.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnItemTapGestureTapped" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Border>
        </Grid>
        
        <picker:SfDatePicker
            x:Name="StartTimePicker"
            Mode="Dialog"
            RelativePosition="AlignBottom"
            TextDisplayMode="FadeAndShrink"
            MaximumDate="{Binding StartTimePickerMaximumDate}"
            MinimumDate="{Binding StartTimePickerMinimumDate}"
            RelativeView = "{x:Reference StartDateCtrl}"
            SelectedDate="{Binding StartDate}">
            <picker:SfDatePicker.HeaderView>
                <picker:PickerHeaderView Text="Start date" Height="40" />
            </picker:SfDatePicker.HeaderView>
            
            <picker:SfDatePicker.FooterView>
                <picker:PickerFooterView ShowOkButton="True" Height="40" />
            </picker:SfDatePicker.FooterView>
        </picker:SfDatePicker>


        <Border
            HorizontalOptions="Center"
            VerticalOptions="Center"
            Stroke="LightGray"
            StrokeThickness="0"
            BackgroundColor="White"
            Padding="20"
            StrokeShape="RoundRectangle 8"
            IsVisible="{Binding IsTouVisible}">
            <Border.Shadow>
                <Shadow Brush="Black"
                        Offset="5,5"
                        Radius="8"
                        Opacity="0.5" />
            </Border.Shadow>

            <VerticalStackLayout Spacing="12">

                <Image
                    Margin="12"
                    Source="banner_tou.png"
                    Aspect="AspectFit"
                    HeightRequest="100"
                    HorizontalOptions="Center"
                    VerticalOptions="Start" />

                <!-- Title -->
                <Label Text="Electricity Tariff Comparison Summary"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="Black"
                       HorizontalOptions="Center" />

                <!-- Intro -->
                <Label
                    Text="A comparison between the Time-of-Use (TOU) tariff and the Flat Rate tariff shows a clear financial advantage for TOU under the current consumption pattern."
                    FontSize="14"
                    TextColor="DimGray"
                    LineBreakMode="WordWrap" />

                <!-- Key figures with mixed styles -->
                <Label>
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="• TOU total cost: " FontSize="14" TextColor="Black" />
                            <Span Text="{Binding TouTotalCost, StringFormat='{}{0:N0} THB'}" FontSize="14"
                                  FontAttributes="Bold" TextColor="ForestGreen" />
                            <Span Text="&#10;• Flat rate total cost: " FontSize="14" TextColor="Black" />
                            <Span Text="{Binding FlatRateTotalCost, StringFormat='{}{0:N0} THB'}" FontSize="14"
                                  FontAttributes="Bold" TextColor="Crimson" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Highlighted savings -->
                <Label FontSize="14"
                       FontAttributes="Bold"
                       LineBreakMode="WordWrap">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="This means the TOU tariff results in a savings of "
                                  TextColor="Black" />
                            <Span Text="{Binding DiffInCurrency, StringFormat='{}{0:N0}'}"
                                  TextColor="ForestGreen" />
                            <Span Text=" THB, equivalent to approximately "
                                  TextColor="Black" />
                            <Span Text="{Binding DiffInPercent, StringFormat='{}{0:n1}'}"
                                  TextColor="ForestGreen" />
                            <Span Text="% lower cost compared to the flat rate option."
                                  TextColor="Black" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Conclusion -->
                <Label
                    Text="In conclusion, based on current data, the TOU tariff is the more economical choice, delivering meaningful cost savings without requiring changes in overall consumption."
                    FontSize="14"
                    TextColor="Black"
                    LineBreakMode="WordWrap" />

            </VerticalStackLayout>
        </Border>


        <Border Stroke="LightGray"
                StrokeThickness="0"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                BackgroundColor="White"
                Padding="20"
                IsVisible="{Binding IsFlatRateVisible}"
                StrokeShape="RoundRectangle 8">
            <Border.Shadow>
                <Shadow Brush="Black"
                        Offset="5,5"
                        Radius="8"
                        Opacity="0.5" />
            </Border.Shadow>

            <VerticalStackLayout Spacing="12">

                <Image
                    Margin="12"
                    Source="banner_flatrate.png"
                    Aspect="AspectFit"
                    HeightRequest="100"
                    HorizontalOptions="Center"
                    VerticalOptions="Start" />

                <!-- Title -->
                <Label Text="Electricity Tariff Comparison Summary"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="Black"
                       HorizontalOptions="Center" />

                <!-- Intro -->
                <Label
                    Text="A comparison between the Time-of-Use (TOU) tariff and the Flat Rate tariff shows the financial impact under the current consumption pattern."
                    FontSize="14"
                    TextColor="DimGray"
                    LineBreakMode="WordWrap" />

                <!-- Key figures with mixed styles -->
                <Label>
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="• TOU total cost: " FontSize="14" TextColor="Black" />
                            <Span Text="{Binding TouTotalCost, StringFormat='{}{0:N0} THB'}" FontSize="14"
                                  FontAttributes="Bold" TextColor="Crimson" />
                            <Span Text="&#10;• Flat rate total cost: " FontSize="14" TextColor="Black" />
                            <Span Text="{Binding FlatRateTotalCost, StringFormat='{}{0:N0} THB'}" FontSize="14"
                                  FontAttributes="Bold" TextColor="ForestGreen" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Highlighted savings -->
                <Label FontSize="14"
                       FontAttributes="Bold"
                       LineBreakMode="WordWrap">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="This means the TOU tariff is "
                                  TextColor="Black" />
                            <Span Text="{Binding DiffInCurrency, StringFormat='{}{0:N0}'}"
                                  TextColor="ForestGreen" />
                            <Span Text=" THB, more expensive, representing a "
                                  TextColor="Black" />
                            <Span Text="{Binding DiffInPercent, StringFormat='{}{0:n1}'}"
                                  TextColor="ForestGreen" />
                            <Span Text="% higher cost compared to the Flat Rate option."
                                  TextColor="Black" />
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Conclusion -->
                <Label
                    Text="The result indicates significant electricity usage during peak-rate hours, where TOU pricing is higher. Unless consumption shifts to off-peak periods, the Flat Rate tariff remains the more cost-efficient choice."
                    FontSize="14"
                    TextColor="DimGray"
                    LineBreakMode="WordWrap" />

            </VerticalStackLayout>
        </Border>
    </VerticalStackLayout>
</ContentView>